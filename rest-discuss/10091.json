{"ygPerms":{"resourceCapabilityList":[{"resourceType":"GROUP","capabilities":[{"name":"READ"},{"name":"JOIN"}]},{"resourceType":"PHOTO","capabilities":[]},{"resourceType":"FILE","capabilities":[]},{"resourceType":"MEMBER","capabilities":[]},{"resourceType":"LINK","capabilities":[]},{"resourceType":"CALENDAR","capabilities":[]},{"resourceType":"DATABASE","capabilities":[]},{"resourceType":"POLL","capabilities":[]},{"resourceType":"MESSAGE","capabilities":[{"name":"READ"}]},{"resourceType":"PENDING_MESSAGE","capabilities":[]},{"resourceType":"ATTACHMENTS","capabilities":[{"name":"READ"}]},{"resourceType":"PHOTOMATIC_ALBUMS","capabilities":[]},{"resourceType":"MEMBERSHIP_TYPE","capabilities":[]},{"resourceType":"POST","capabilities":[{"name":"READ"}]},{"resourceType":"PIN","capabilities":[]}],"groupUrl":"groups.yahoo.com","intlCode":"us"},"comscore":"pageview_candidate","ygData":{"userId":302633978,"authorName":"Daniel Yokomizo","from":"&quot;Daniel Yokomizo&quot; &lt;daniel.yokomizo@...&gt;","profile":"daniel_yokomiso","replyTo":"SENDER","senderId":"bLxuJWClCrnDt2TcmUOLN57kY5KOMvPECn1TkqB97RKQodW0KcMZzHSRU7D-J4um23_u917rUzgnxXLIobv8x9-NtwAzP_3KqvShbPREQovSkBrz","spamInfo":{"isSpam":false,"reason":"12"},"subject":"Re: [rest-discuss] Idempotency of PUT when using IF-MATCH","postDate":"1198850915","msgId":10091,"canDelete":false,"contentTrasformed":false,"systemMessage":false,"headers":{"messageIdInHeader":"PGU1YzZlY2FiMDcxMjI4MDYwOHIxZDFlMGQ5Y3ExNGMxY2QwZjM2NTkwMDhlQG1haWwuZ21haWwuY29tPg==","inReplyToHeader":"PDQ3NzRGQ0I3LjMwMDAxMDdAZ214LmRlPg==","referencesHeader":"PGU1YzZlY2FiMDcxMjI3MjMyMHMzZGE1NGZwNmYwM2EwMDMwM2NiMGMxN0BtYWlsLmdtYWlsLmNvbT4JIDw0Nzc0RkNCNy4zMDAwMTA3QGdteC5kZT4="},"prevInTopic":10090,"nextInTopic":10092,"prevInTime":10090,"nextInTime":10092,"topicId":10088,"numMessagesInTopic":12,"msgSnippet":"... I wasn t entirely clear. Arguably all the versions of the entity are current, as the user may get older versions and at a future date branch on old","rawEmail":"Return-Path: &lt;daniel.yokomizo@...&gt;\r\nX-Sender: daniel.yokomizo@...\r\nX-Apparently-To: rest-discuss@yahoogroups.com\r\nX-Received: (qmail 85631 invoked from network); 28 Dec 2007 14:08:37 -0000\r\nX-Received: from unknown (66.218.67.95)\n  by m44.grp.scd.yahoo.com with QMQP; 28 Dec 2007 14:08:37 -0000\r\nX-Received: from unknown (HELO fg-out-1718.google.com) (72.14.220.155)\n  by mta16.grp.scd.yahoo.com with SMTP; 28 Dec 2007 14:08:37 -0000\r\nX-Received: by fg-out-1718.google.com with SMTP id 16so3980688fgg.38\n        for &lt;rest-discuss@yahoogroups.com&gt;; Fri, 28 Dec 2007 06:08:35 -0800 (PST)\r\nX-Received: by 10.86.62.3 with SMTP id k3mr8963852fga.15.1198850915935;\n        Fri, 28 Dec 2007 06:08:35 -0800 (PST)\r\nX-Received: by 10.86.89.19 with HTTP; Fri, 28 Dec 2007 06:08:35 -0800 (PST)\r\nMessage-ID: &lt;e5c6ecab0712280608r1d1e0d9cq14c1cd0f3659008e@...&gt;\r\nDate: Fri, 28 Dec 2007 14:08:35 +0000\r\nTo: &quot;Julian Reschke&quot; &lt;julian.reschke@...&gt;\r\nCc: rest-discuss@yahoogroups.com\r\nIn-Reply-To: &lt;4774FCB7.3000107@...&gt;\r\nMIME-Version: 1.0\r\nContent-Type: text/plain; charset=ISO-8859-1\r\nContent-Transfer-Encoding: 7bit\r\nContent-Disposition: inline\r\nReferences: &lt;e5c6ecab0712272320s3da54fp6f03a00303cb0c17@...&gt;\n\t &lt;4774FCB7.3000107@...&gt;\r\nX-eGroups-Msg-Info: 1:12:0:0:0\r\nFrom: &quot;Daniel Yokomizo&quot; &lt;daniel.yokomizo@...&gt;\r\nSubject: Re: [rest-discuss] Idempotency of PUT when using IF-MATCH\r\nX-Yahoo-Group-Post: member; u=302633978; y=Z6vFvJJKFXI5ZZ7hBrc4mWZidx6BzcyyJqzlqg7YKn3WwTmWH-CJqXaJ\r\nX-Yahoo-Profile: daniel_yokomiso\r\n\r\nOn Dec 28, 2007 1:40 PM, Julian Reschke &lt;julian.reschke@...&gt; wrote:\n&gt;\n&gt; Daniel Yokomizo wrote:\n&gt; &gt;\n&gt; &gt; Hi,\n&gt; &gt;\n&gt; &gt; I&#39;m writing a RESTful application that has provides versioning of\n&gt; &gt; (persisted) entities. I&#39;m using the version identifier as the ETag for\n&gt; &gt; the related resources, so far so good. As the clients update the\n&gt; &gt; entities, they send a PUT request with a IF-MATCH header with their\n&gt; &gt; last version identifier so we can avoid some concurrency problems with\n&gt; &gt; optimistic locking. To create the versioning identifier I&#39;m digesting\n&gt; &gt; (SHA-256) the resource state: I&#39;m exchanging a very small chance of\n&gt; &gt; collision against the chance to detect previously sent updates. When a\n&gt; &gt; client send a PUT request I have the IF-MATCH ETag and I compute the\n&gt; &gt; new ETag automatically. Now suppose this sequence of events:\n&gt; &gt;\n&gt; &gt; 1. Client A sents PUT ... (IF-MATCH: &quot;XXX&quot;) ... FOO ...\n&gt; &gt; 2. Server process the request and sends the new ETag: YYY\n&gt; &gt; 3. Client B sents PUT ... (IF-MATCH: &quot;YYY&quot;) ... BAR\n&gt; &gt; 4. Server process the request and sends the new ETag: ZZZ\n&gt; &gt; 5. Client A retries the first PUT (network problems, double submit, it\n&gt; &gt; doesn&#39;t matter) sends ETag: YYY\n&gt; &gt;\n&gt; &gt; My application can compute the new version identifier for FOO and\n&gt; &gt; it will always be YYY, so doing a quick check it finds this version\n&gt; &gt; already persisted and it can safely assume that it&#39;s a duplicate\n&gt; &gt; submission. My question is: can it return a 200 to this duplicate\n&gt; &gt; request or it must return a 412, as per section 14.24? AFAICT\n&gt; &gt; returning 200 should be OK, but I don&#39;t want to take chances of going\n&gt; &gt; against the Internet ;) or messing with some subtle implicit rule\n&gt; &gt; about caching (e.g. some intermediate cache between both client A and\n&gt; &gt; client B overwrite B&#39;s update and become inconsistent) .\n&gt;\n&gt; Could you elaborate why you think not sending a 412 would be ok? It\n&gt; seems 14.24 is clear enough:\n&gt;\n&gt; &quot;If none of the entity tags match, or if &quot;*&quot; is given and no current\n&gt; entity exists, the server MUST NOT perform the requested method, and\n&gt; MUST return a 412 (Precondition Failed) response. This behavior is most\n&gt; useful when the client wants to prevent an updating method, such as PUT,\n&gt; from modifying a resource that has changed since the client last\n&gt; retrieved it.&quot; --\n&gt; &lt;http://greenbytes.de/tech/webdav/rfc2616.html#rfc.section.14.24.p.5&gt;\n\nI wasn&#39;t entirely clear. Arguably all the versions of the entity are\ncurrent, as the user may get older versions and at a future date\nbranch on old versions. Instead of creating a protocol to handle\nversioning above HTTP I thought using the existing versioning support\nwould be better.\n\n&gt; So yes, PUT isn&#39;t idempotent when used as a conditional request.\n\nWhere is this specified? Or is a known convention?\n\nIn this situation the server knows that this is a repeated submission\nand it&#39;s semantically safe to ignore it. I could just drop IF-MATCH in\nthis case and make the client send the version identifier in the\nrequest body, but I&#39;m not sure the problem would be much different. If\nI ignore IF-MATCH issues the same situation can happen and the server\ncan safely ignore the duplicate PUT, but I would still ask the same\nquestion.\n\n&gt; BR, Julian\n\nBest regards,\nDaniel Yokomizo.\n\n"}}